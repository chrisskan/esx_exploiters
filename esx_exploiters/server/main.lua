ESX = nil

local loadoutNum, weapon

TriggerEvent('esx:getSharedObject', function(obj) ESX = obj end)
 


RegisterServerEvent('esx_exploiters:runningfast')
AddEventHandler('esx_exploiters:runningfast',function(speed)
    local xplayer = ESX.GetPlayerFromId(source)
    local allplayers = ESX.GetPlayers()
    if xplayer ~= nil then
        if xplayer.getGroup() ~= 'superadmin' and xplayer.getGroup() ~= 'mod' then
            if Config.RunningTrackingWebhook ~= nil then
                TriggerEvent('DiscordBot:ToDiscord', Config.RunningTrackingWebhook,'AntiCheat' ,xplayer.getName()..' is travelling with '..speed, 'https://making-the-web.com/sites/default/files/clipart/174559/speed-png-transparent-images-174559-6047226.png', false)
            end
            for i=1,#allplayers do                
                if ESX.GetPlayerFromId(allplayers[i]).getGroup() ~= 'user' then
                    TriggerClientEvent('announce', allplayers[i], xplayer.getName()..' is travelling way too fast!!')
                end       
            end      
        end
    end
end)



RegisterServerEvent('esx_exploiters:announcetostuff')
AddEventHandler('esx_exploiters:announcetostuff',function(msg)
    local allplayers = ESX.GetPlayers()
    for i=1,#allplayers do
        local p = ESX.GetPlayerFromId(allplayers[i])
        if p ~= nil then
            if p.getGroup() ~= 'user' then
                TriggerClientEvent('announce', allplayers[i], msg)
            end
        end
    end
end)

RegisterServerEvent('esx_exploiters:aim')
AddEventHandler('esx_exploiters:aim',function(aim)
    local xplayer = ESX.GetPlayerFromId(source)
    local aimplayer = ESX.GetPlayerFromId(aim)
    if xplayer ~= nil and aimplayer ~= nil and Config.AimTrackingWebhook ~= nil then
        if aimplayer ~= nil then
            TriggerEvent('DiscordBot:ToDiscord', 'https://discordapp.com/api/webhooks/616045714002411531/AWLXS27MRoxECtpVoyU5N9AX7F5L1v39j1TYsevC7FdofiJZLO6IIFv1BK8Rf_KcrSzy','AimLogs' ,xplayer.getName()..' is aiming '..aimplayer.getName(), 'https://www.thetrace.org/wp-content/uploads/2019/05/ghostgun-03.jpg', false)
        end
    end
end)


RegisterServerEvent('esx_exploiters:checkloadout')
AddEventHandler('esx_exploiters:checkloadout',function()
    local xplayer = ESX.GetPlayerFromId(source)
    if xplayer ~= nil then
        if xplayer.getGroup() ~= 'superadmin' then
            
            for i=1, #Config.BlackListedWeapons do 
                loadoutNum, weapon = xplayer.getWeapon(Config.BlackListedWeapons[i])
                if xplayer.hasWeapon(Config.BlackListedWeapons[i]) then

                    TriggerEvent('esx_exploiters:announcetostuff',xplayer.getName()..' has a '..weapon.label)
                    if Config.LoadoutTrackingWebhook ~= nil then
                        TriggerEvent('DiscordBot:ToDiscord', Config.LoadoutTrackingWebhook,'AntiCheat' ,xplayer.getName()..' has a '..weapon.label, 'https://imgur.com/SkY6ph1.png', false)
                    end
                    break
                end
            end   
        end
    end
end)